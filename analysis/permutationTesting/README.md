## Permutation testing

This folder contains scripts and code to determine a significance for a given 3-mer's weight for a given subgroup,
based on repeatedly shuffling labels on the training data for the subgroup, re-training, and, after repeating the 
shuffling and retraining many times, counting how often weights >= the original weight are seen

The results of this analysis relate to Table 3 and the corresponding discussion in the manuscript.

---
### Compiling source code (if available)
If you have access to the source code only, then the Java programs can be compiled using the following commands:
```
javac PermuteLabels.java
javac WeightAnalysis.java
javac AssociateWithKmerString.java
```

---
### Executing programs
The order of running scripts is 
```
./ahpEScript.sh
./prx1Script.sh
./prx5Script.sh
./prx6Script.sh
./prxQScript.sh
./tpxScript.sh
./doWeightAnalysis.sh
./addKmerStrings.sh
```

The first six scripts could be run simultaneously and/or in any order; the last two scripts *doWeightAnalysis.sh* and *addKmerStrings.sh* should be run in order and only be run after the six subgroup specific scripts run.

---
### Description of *ahpEScript.sh* (and the other five subgroup-specific scripts)
This is a bash script which loops 2000 times doing the following:
* Using the *PermuteLabels* program to change the labels on the AhpE training data (from the original correct labels to randomized labels)
* Learning a linear classifier on the now randomly labeled training set
* Extracting the weights (scores) from the learned linear model
* Storing those weights in a file

Note that this is done separately, via the six different subgroup scripts, for each Prx subgroup.  These scripts take a long time to run
and generate large output files as they contain output weights for 2000 instances of ~8000 3-mer features.

The number of iterations could be changed if desired.

---
### Description of *doWeightAnalysis.sh*
This script uses the program *WeightAnalysis* to examine in how many of the instances of training on ranodmly labeled data
are the weights  for a given 3-mer feature higher than the weights for the feature when learned on the actual training data.
This provides a measure of how unlikely it is to see a given SVM weight.  

Each output file (one per subgroup) from the *WeightAnalysis* program is formatted similar to as follows (this is an arbitrary four
lines of the output of the AhpE analysis):
```
836 0.02963357328 0 2000 0.0
43 0.0291742090704 1 2000 5.0E-4
82 0.0288267014261 0 2000 0.0
64 0.0283221257027 3 2000 0.0015
```
The first column represents an index for a 3-mer.  The second column represents the SVM linear classifier weight for that feature
on the original training data.  The third column is in how many instances of the models trained on the randomly labeled data
was the weight for that 3-mer feature greater than the original weight (the value in the 2nd column).  The fourth column is how many
iterations of permutations were performed, and the fifth column is (column 3 / column 4) which can be considered as a P value.

To dig in specifically on the example output, it shows (on the last line) that 3-mer indexed 64 had an original weight of 0.0283221257027 when training was performed on the original data set.
When the labels were randomly permuted and training done again (2000 times), in 3 of those 2000 times a weight >= to 0.0283221257027
was seen for feature 64.  For features 836 and 82, in none of the 2000 permutations was a weight greater than the original weight found, and for feature 43, only 1 of the 2000 permutations had a higher weight.

The output file will be ordered by the 2nd column (the weights from training on the original data). To help in downstream analysis,
it could be useful to sort by the 5th column and then, within ties, by the 2nd column.  One will need to decide an appropriate P value
threshold to use to consider a feature as interesting, taking into account that a large number of 3-mers are being analyzed.

---
### Description of *addKmerStrings.sh*
This script uses the program *AssociateWithKmerString* to map the indices in the output files generated by the *doWeightAnalys.sh* script to the actual 3-mer strings.  The indices in the output from the previous step are taken from the SVM-Light feature indices and are integer indices 1, 2, 3, ... n.  The actual 3-mer strings in the *all.kmerMap* file are indexed 0..n-1.  This program creates a new output file by reading and updating the output from the previous step line-by-line.  This is done by a process of extracting the index of interest from each line of output, subtracting 1 from the index, mapping that to the appropriate 3-mer string, pre-pending the 3-mer string onto the line of output, and writing that to a new file.  

The example data from above (part of the AhpE analysis) is now in the form of
```
MCT 836 0.02963357328 0 2000 0.0
TSV 43 0.0291742090704 1 2000 5.0E-4
ANR 82 0.0288267014261 0 2000 0.0
AEV 64 0.0283221257027 3 2000 0.0015
```

**NOTE**: The *all.kmerMap* file used here is the same as the k-mer map used in the *analysis/svmModeling* folder.  If you are using these tools on your own data, make sure to replace the *all.kmerMap* file in this folder with the one you generate from modeling.
